---
- name: Copy all files to "{{ inventory_host }}"
  copy:
    src: "{{ item }}" 
    dest: /var/ossec/tmp
  with_items:
    - ../../testfiles/test1AddLog.log
    - ../../testfiles/test1AddLog.py
    - ../../testfiles/test1JSONLog.json
    - ../../testfiles/test1ossec.conf

- name: Append conf to ossec.conf
  command: cat /var/ossec/tmp/Test1ossec.conf >> /var/ossec/etc/ossec.conf

- name: Restarting agent
  service:
    name: wazuh-agent
    state: restarted

- name: Waiting for restart
  pause:
    seconds: 10

- name: Writing alert to log
  command: cat /var/ossec/tmp/test1AddLog.log >> /var/ossec/logs/test1AddLog.log

- name: Running Test
  command: pytest /var/ossec/tmp/test1AddLog.py::test_AddLogAgent
    
